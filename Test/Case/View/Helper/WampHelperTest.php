<?php

/*
 * This file is part of Ratchet for CakePHP.
 *
 ** (c) 2012 - 2013 Cees-Jan Kiewiet
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

App::uses('WampHelper', 'Ratchet.View/Helper');

App::uses('HtmlHelper', 'View/Helper');
App::uses('View', 'View');


class RatchetHelperTest extends CakeTestCase {

/**
 * start a test
 *
 * @return void
 **/
	public function setUp() {
		parent::setUp();

		$controller = null;
		$request = new CakeRequest(null, false);
		$request->webroot = '';
		$this->view = new View($controller);
		$this->view->request = $request;
		$this->Helper = new WampHelper($this->view, array('noconfig' => true));
		$this->Helper->Html = new HtmlHelper($this->view);

		Router::reload();
		Configure::write('debug', 2);
	}

/**
 * end a test
 *
 * @return void
 **/
	public function tearDown() {
		parent::tearDown();
		unset($this->Helper);
	}

/**
 * test the script includes generated by init
 *
 * @return void
 */
	public function testInit() {
                $this->Helper->init();
                $this->assertEqual($this->view->fetch('script'), "<script type=\"text/javascript\">\n//<![CDATA[\nWEB_SOCKET_SWF_LOCATION = \"http://localhost/Ratchet/swf/WebSocketMain.swf\";\nvar cakeWamp = window.cakeWamp || {};\ncakeWamp.options = {retryDelay: 500,maxRetries: 500};\nvar wsuri = \"ws://localhost:80/websocket\";\n//]]>\n</script><script type=\"text/javascript\" src=\"/js/cache/Ratchet.wamp.js\"></script>");
	}

}